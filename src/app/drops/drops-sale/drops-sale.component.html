<div
  *ngIf="!isLoading; else loading"
  class="flex flex-col gap-16 w-9/12 mx-auto text-xl md:text-2xl lg:text-3xl text-white nifty-font"
>
  <p class="nifty-text-gold">{{ dropName }}</p>
  <div class="grid grid-cols-1 gap-20 lg:grid-cols-2">
    <div class="flex flex-col gap-2">
      <div
        class="relative cursor-pointer"
        (click)="showWinnerNftImage = !showWinnerNftImage"
      >
        <app-nft-displayer
          [ngClass]="[!showWinnerNftImage ? 'block' : 'hidden']"
          [nftURL]="defaultNftImage"
        ></app-nft-displayer>
        <app-nft-displayer
          [ngClass]="[showWinnerNftImage ? 'block' : 'hidden']"
          [nftURL]="winnerNftImage"
        ></app-nft-displayer>
      </div>
      <p class="text-xs">{{ nftImageText }}</p>
    </div>
    <div class="flex flex-col gap-5 text-lg text-center">
      <p class="nifty-text-red">{{ leftForSale }}</p>
      <div
        class="flex flex-col gap-5 justify-around p-8 bg-black border-4 rounded-md nifty-border-gold"
      >
        <ng-container *ngIf="!hasBattleStarted; else purchaseEnded">
          <ng-container
            *ngIf="
              isPurchaseSuccessful;
              then purchaseSuccessful;
              else purchaseCheckout
            "
          ></ng-container>
        </ng-container>
      </div>
    </div>
  </div>
  <div class="flex flex-col gap-2">
    <p>NFT Description</p>
    <p>{{ nftDescription }}</p>
  </div>
  <div class="flex flex-col gap-2 text-xs">
    <p>Disclaimer:</p>
    <p>
      This is a signed and limited edition digital creation. With the purchase,
      you acknowledge that you'll be given the right to use, distribute and
      display the creation for non-commercial purposes. You may also re-sell the
      same non-commercial use rights, to the creation, through the secondary
      sales portal on the Battles page or any other marketplace. Purchase of
      NFTs from the Drop entitles you to participate in the Battle Royale game
      for this Drop with a fair chance to win a 1/1 upgrade to replace the
      winning base NFT. All sales are final.
    </p>
  </div>
</div>

<ng-template #purchaseCheckout>
  <div
    class="flex border-solid border-2 border-gray-500 border-r-0 border-l-0 border-t-0"
  >
    <p class="font-bold">Quantity</p>
    <div class="flex flex-row-reverse flex-grow">
      <p>1</p>
    </div>
  </div>
  <div
    class="flex border-dashed border-2 border-gray-500 border-r-0 border-l-0 border-t-0"
  >
    <p>Price</p>
    <div class="flex flex-row-reverse flex-grow">
      <p>{{ ethPrice }} Ξ</p>
    </div>
  </div>
  <div
    class="flex border-dashed border-2 border-gray-500 border-r-0 border-l-0 border-t-0"
  >
    <p>Gas price</p>
    <div class="flex flex-row-reverse flex-grow">
      <p>{{ this.gasPrice }} GWEI</p>
    </div>
  </div>
  <div
    class="flex border-solid border-4 border-gray-500 border-r-0 border-l-0 border-t-0"
  >
    <p>Gas fee</p>
    <div class="flex flex-row-reverse flex-grow">
      <p>+{{ ethFees.toFixed(4) }} Ξ</p>
    </div>
  </div>
  <div class="flex">
    <p class="font-bold">Total</p>
    <div class="flex flex-row-reverse flex-grow">
      <p>{{ (ethPrice + ethFees).toFixed(4) }} Ξ</p>
    </div>
  </div>
  <button
    *ngIf="isAccountConnected"
    type="button"
    class="inline-flex items-center justify-center px-4 py-2 border border-transparent text-base leading-6 font-medium rounded-md text-white bg-green-500 hover:bg-green-400 transition ease-in-out duration-150"
    (click)="buy()"
    [ngClass]="{
      'cursor-not-allowed hover:bg-green-500': isPurchaseProcessing
    }"
    [disabled]="isPurchaseProcessing"
  >
    <svg
      *ngIf="isPurchaseProcessing"
      class="animate-spin -ml-1 mr-3 h-5 w-5 text-white"
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
    >
      <circle
        class="opacity-25"
        cx="12"
        cy="12"
        r="10"
        stroke="currentColor"
        stroke-width="4"
      ></circle>
      <path
        class="opacity-75"
        fill="currentColor"
        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
      ></path>
    </svg>
    {{ checkoutBtnText }}
  </button>
  <div *ngIf="!isAccountConnected" class="flex justify-center nifty-text-red">
    <p>Connect Wallet!</p>
  </div>
</ng-template>

<ng-template #purchaseSuccessful>
  <p>Purchase successful!</p>
  <p>
    TxID
    <a
      class="underline"
      [title]="transactionHash"
      [href]="'https://rinkeby.etherscan.io/tx/' + transactionHash"
      target="_blank"
    >
      {{ formatAddress(transactionHash) }}
    </a>
  </p>
  <p>
    Your NFT has now been entered into the Battle Royale for
    <span class="nifty-text-gold">{{ dropName }}</span>
  </p>
  <button
    type="button"
    class="inline-flex items-center justify-center px-4 py-2 border border-transparent text-base leading-6 font-medium rounded-md text-white bg-green-500 hover:bg-green-400 transition ease-in-out duration-150"
    (click)="goToBattle()"
  >
    Proceed to Battle
  </button>
  <span class="text-xs">
    *Please note there may be a few minutes delay before your NFT shows up on
    the battle screen
  </span>
</ng-template>

<ng-template #purchaseEnded>
  <p class="text-lg nifty-text-red">Sale is over!</p>
  <p>
    The initial sale for this drop has concluded. To obtain an NFT for this drop
    please head over to the Battle page to purchase NFTs listed for sale or to
    make offers on NFTs not currently listed for sale.
  </p>
  <button
    type="button"
    class="inline-flex items-center justify-center px-4 py-2 border border-transparent text-base leading-6 font-medium rounded-md text-white bg-green-500 hover:bg-green-400 transition ease-in-out duration-150"
    (click)="goToBattle()"
  >
    Proceed to Battle
  </button>
</ng-template>

<ng-template #loading>
  <div class="content-around">
    <div class="flex flex-row justify-center">
      <p-progressSpinner></p-progressSpinner>
    </div>
  </div>
</ng-template>
